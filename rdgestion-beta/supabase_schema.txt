-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.amortissements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  immobilisation_id uuid NOT NULL,
  exercice_id uuid NOT NULL,
  annee integer NOT NULL,
  base_amortissement numeric NOT NULL,
  taux numeric,
  dotation numeric NOT NULL,
  amortissement_cumule numeric NOT NULL,
  vnc numeric NOT NULL,
  ecriture_id uuid,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT amortissements_pkey PRIMARY KEY (id),
  CONSTRAINT amortissements_immobilisation_id_fkey FOREIGN KEY (immobilisation_id) REFERENCES public.immobilisations(id),
  CONSTRAINT amortissements_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices(id),
  CONSTRAINT amortissements_ecriture_id_fkey FOREIGN KEY (ecriture_id) REFERENCES public.ecritures(id),
  CONSTRAINT amortissements_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.audit_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid,
  user_id uuid,
  action character varying NOT NULL,
  table_name character varying NOT NULL,
  record_id uuid,
  old_values jsonb,
  new_values jsonb,
  ip_address inet,
  user_agent text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT audit_log_pkey PRIMARY KEY (id),
  CONSTRAINT audit_log_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT audit_log_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.categories_immo (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  compte_immo character varying,
  compte_amortissement character varying,
  compte_dotation character varying,
  duree_amortissement integer,
  methode USER-DEFINED DEFAULT 'lineaire'::methode_amortissement,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT categories_immo_pkey PRIMARY KEY (id),
  CONSTRAINT categories_immo_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id)
);
CREATE TABLE public.categories_produits (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  parent_id uuid,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT categories_produits_pkey PRIMARY KEY (id),
  CONSTRAINT categories_produits_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT categories_produits_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.categories_produits(id)
);
CREATE TABLE public.documents (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  exercice_id uuid NOT NULL,
  type USER-DEFINED NOT NULL,
  sens character varying NOT NULL CHECK (sens::text = ANY (ARRAY['vente'::character varying, 'achat'::character varying]::text[])),
  numero character varying NOT NULL,
  tiers_id uuid NOT NULL,
  date_document date NOT NULL,
  date_echeance date,
  date_validite date,
  objet text,
  montant_ht numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL DEFAULT 0,
  statut_paiement USER-DEFINED DEFAULT 'non_paye'::statut_paiement,
  montant_paye numeric DEFAULT 0,
  statut USER-DEFINED NOT NULL DEFAULT 'brouillon'::statut_document,
  document_origine_id uuid,
  ecriture_id uuid,
  notes text,
  conditions text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_by uuid NOT NULL,
  updated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT documents_pkey PRIMARY KEY (id),
  CONSTRAINT documents_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT documents_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices(id),
  CONSTRAINT documents_tiers_id_fkey FOREIGN KEY (tiers_id) REFERENCES public.tiers(id),
  CONSTRAINT documents_document_origine_id_fkey FOREIGN KEY (document_origine_id) REFERENCES public.documents(id),
  CONSTRAINT documents_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT documents_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT fk_documents_ecriture FOREIGN KEY (ecriture_id) REFERENCES public.ecritures(id)
);
CREATE TABLE public.ecritures (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  exercice_id uuid NOT NULL,
  periode_id uuid,
  journal_id uuid NOT NULL,
  numero_piece character varying,
  date_ecriture date NOT NULL,
  libelle text NOT NULL,
  statut USER-DEFINED NOT NULL DEFAULT 'brouillard'::statut_ecriture,
  document_id uuid,
  montant_total numeric,
  validee_par uuid,
  date_validation timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_by uuid NOT NULL,
  updated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT ecritures_pkey PRIMARY KEY (id),
  CONSTRAINT ecritures_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT ecritures_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices(id),
  CONSTRAINT ecritures_periode_id_fkey FOREIGN KEY (periode_id) REFERENCES public.periodes(id),
  CONSTRAINT ecritures_journal_id_fkey FOREIGN KEY (journal_id) REFERENCES public.journaux(id),
  CONSTRAINT ecritures_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id),
  CONSTRAINT ecritures_validee_par_fkey FOREIGN KEY (validee_par) REFERENCES public.users(id),
  CONSTRAINT ecritures_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT ecritures_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.entreprises (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  raison_sociale character varying NOT NULL,
  siret character varying,
  code_naf character varying,
  forme_juridique character varying,
  capital numeric,
  adresse text,
  code_postal character varying,
  ville character varying,
  pays character varying DEFAULT 'France'::character varying,
  telephone character varying,
  email character varying,
  numero_tva_intra character varying,
  regime_tva USER-DEFINED DEFAULT 'reel_normal'::regime_tva,
  comptes_bancaires jsonb DEFAULT '[]'::jsonb,
  config jsonb DEFAULT '{"devise": "EUR", "decimales": 2}'::jsonb,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT entreprises_pkey PRIMARY KEY (id),
  CONSTRAINT entreprises_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.exercices (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  libelle character varying NOT NULL,
  date_debut date NOT NULL,
  date_fin date NOT NULL,
  cloture boolean NOT NULL DEFAULT false,
  date_cloture timestamp with time zone,
  cloture_par uuid,
  report_an jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT exercices_pkey PRIMARY KEY (id),
  CONSTRAINT exercices_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT exercices_cloture_par_fkey FOREIGN KEY (cloture_par) REFERENCES public.users(id)
);
CREATE TABLE public.immobilisations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  categorie_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  description text,
  date_acquisition date NOT NULL,
  date_mise_service date,
  valeur_acquisition numeric NOT NULL,
  fournisseur_id uuid,
  numero_facture character varying,
  methode USER-DEFINED NOT NULL DEFAULT 'lineaire'::methode_amortissement,
  duree_amortissement integer NOT NULL,
  valeur_residuelle numeric DEFAULT 0,
  compte_immo character varying,
  compte_amortissement character varying,
  compte_dotation character varying,
  amortissement_cumule numeric DEFAULT 0,
  vnc numeric,
  date_sortie date,
  motif_sortie character varying,
  prix_cession numeric,
  actif boolean NOT NULL DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT immobilisations_pkey PRIMARY KEY (id),
  CONSTRAINT immobilisations_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT immobilisations_categorie_id_fkey FOREIGN KEY (categorie_id) REFERENCES public.categories_immo(id),
  CONSTRAINT immobilisations_fournisseur_id_fkey FOREIGN KEY (fournisseur_id) REFERENCES public.tiers(id),
  CONSTRAINT immobilisations_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.journaux (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  type USER-DEFINED NOT NULL,
  compte_contrepartie character varying,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT journaux_pkey PRIMARY KEY (id),
  CONSTRAINT journaux_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id)
);
CREATE TABLE public.lignes_document (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  document_id uuid NOT NULL,
  numero_ligne integer NOT NULL,
  produit_id uuid,
  designation text NOT NULL,
  quantite numeric NOT NULL DEFAULT 1,
  unite character varying DEFAULT 'unité'::character varying,
  prix_unitaire_ht numeric NOT NULL,
  remise_pourcent numeric DEFAULT 0,
  montant_ht numeric NOT NULL,
  taux_tva_id uuid,
  taux_tva numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL,
  compte character varying,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_document_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_document_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id),
  CONSTRAINT lignes_document_produit_id_fkey FOREIGN KEY (produit_id) REFERENCES public.produits(id),
  CONSTRAINT lignes_document_taux_tva_id_fkey FOREIGN KEY (taux_tva_id) REFERENCES public.taux_tva(id)
);
CREATE TABLE public.lignes_ecriture (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  ecriture_id uuid NOT NULL,
  numero_ligne integer NOT NULL,
  compte_id uuid NOT NULL,
  compte_numero character varying NOT NULL,
  tiers_id uuid,
  libelle text,
  debit numeric NOT NULL DEFAULT 0 CHECK (debit >= 0::numeric),
  credit numeric NOT NULL DEFAULT 0 CHECK (credit >= 0::numeric),
  lettrage character varying,
  date_lettrage timestamp with time zone,
  lettre_par uuid,
  rapproche boolean DEFAULT false,
  rapprochement_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_ecriture_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_ecriture_ecriture_id_fkey FOREIGN KEY (ecriture_id) REFERENCES public.ecritures(id),
  CONSTRAINT lignes_ecriture_compte_id_fkey FOREIGN KEY (compte_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT lignes_ecriture_tiers_id_fkey FOREIGN KEY (tiers_id) REFERENCES public.tiers(id),
  CONSTRAINT lignes_ecriture_lettre_par_fkey FOREIGN KEY (lettre_par) REFERENCES public.users(id)
);
CREATE TABLE public.modes_reglement (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  type USER-DEFINED NOT NULL,
  compte_contrepartie character varying,
  delai_jours integer DEFAULT 0,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT modes_reglement_pkey PRIMARY KEY (id),
  CONSTRAINT modes_reglement_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id)
);
CREATE TABLE public.mouvements_stock (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  produit_id uuid NOT NULL,
  type USER-DEFINED NOT NULL,
  date_mouvement date NOT NULL,
  quantite numeric NOT NULL,
  prix_unitaire numeric,
  document_id uuid,
  ligne_document_id uuid,
  ecriture_id uuid,
  libelle text,
  stock_avant numeric,
  stock_apres numeric,
  created_by uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT mouvements_stock_pkey PRIMARY KEY (id),
  CONSTRAINT mouvements_stock_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT mouvements_stock_produit_id_fkey FOREIGN KEY (produit_id) REFERENCES public.produits(id),
  CONSTRAINT mouvements_stock_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id),
  CONSTRAINT mouvements_stock_ligne_document_id_fkey FOREIGN KEY (ligne_document_id) REFERENCES public.lignes_document(id),
  CONSTRAINT mouvements_stock_ecriture_id_fkey FOREIGN KEY (ecriture_id) REFERENCES public.ecritures(id),
  CONSTRAINT mouvements_stock_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.periodes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  exercice_id uuid NOT NULL,
  mois integer NOT NULL CHECK (mois >= 1 AND mois <= 12),
  annee integer NOT NULL,
  libelle character varying,
  date_debut date NOT NULL,
  date_fin date NOT NULL,
  cloturee boolean NOT NULL DEFAULT false,
  date_cloture timestamp with time zone,
  cloturee_par uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT periodes_pkey PRIMARY KEY (id),
  CONSTRAINT periodes_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices(id),
  CONSTRAINT periodes_cloturee_par_fkey FOREIGN KEY (cloturee_par) REFERENCES public.users(id)
);
CREATE TABLE public.plan_comptable (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  numero character varying NOT NULL,
  libelle character varying NOT NULL,
  classe integer NOT NULL CHECK (classe >= 1 AND classe <= 8),
  type character varying NOT NULL DEFAULT 'detail'::character varying CHECK (type::text = ANY (ARRAY['titre'::character varying, 'total'::character varying, 'detail'::character varying]::text[])),
  sens_normal character varying CHECK (sens_normal::text = ANY (ARRAY['debit'::character varying, 'credit'::character varying]::text[])),
  lettrable boolean NOT NULL DEFAULT false,
  rapprochable boolean NOT NULL DEFAULT false,
  actif boolean NOT NULL DEFAULT true,
  compte_parent character varying,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT plan_comptable_pkey PRIMARY KEY (id),
  CONSTRAINT plan_comptable_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id)
);
CREATE TABLE public.produits (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  reference character varying NOT NULL,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['produit'::character varying, 'service'::character varying]::text[])),
  categorie_id uuid,
  libelle character varying NOT NULL,
  description text,
  prix_achat_ht numeric,
  prix_vente_ht numeric NOT NULL,
  taux_tva_id uuid,
  gestion_stock boolean NOT NULL DEFAULT false,
  stock_actuel numeric DEFAULT 0,
  stock_minimum numeric DEFAULT 0,
  stock_alerte numeric,
  unite character varying DEFAULT 'unité'::character varying,
  compte_vente character varying,
  compte_achat character varying,
  compte_stock character varying,
  actif boolean NOT NULL DEFAULT true,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT produits_pkey PRIMARY KEY (id),
  CONSTRAINT produits_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT produits_categorie_id_fkey FOREIGN KEY (categorie_id) REFERENCES public.categories_produits(id),
  CONSTRAINT produits_taux_tva_id_fkey FOREIGN KEY (taux_tva_id) REFERENCES public.taux_tva(id),
  CONSTRAINT produits_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT produits_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.rapprochements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  compte_bancaire character varying NOT NULL,
  date_rapprochement date NOT NULL,
  solde_releve numeric NOT NULL,
  solde_comptable numeric NOT NULL,
  ecart numeric DEFAULT (solde_releve - solde_comptable),
  statut character varying DEFAULT 'en_cours'::character varying CHECK (statut::text = ANY (ARRAY['en_cours'::character varying, 'valide'::character varying]::text[])),
  valide_par uuid,
  date_validation timestamp with time zone,
  notes text,
  created_by uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT rapprochements_pkey PRIMARY KEY (id),
  CONSTRAINT rapprochements_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT rapprochements_valide_par_fkey FOREIGN KEY (valide_par) REFERENCES public.users(id),
  CONSTRAINT rapprochements_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.reglements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  sens character varying NOT NULL CHECK (sens::text = ANY (ARRAY['encaissement'::character varying, 'decaissement'::character varying]::text[])),
  tiers_id uuid NOT NULL,
  document_id uuid,
  numero character varying,
  date_reglement date NOT NULL,
  mode_reglement_id uuid,
  montant numeric NOT NULL CHECK (montant > 0::numeric),
  reference text,
  compte_bancaire character varying,
  ecriture_id uuid,
  rapproche boolean DEFAULT false,
  rapprochement_id uuid,
  notes text,
  created_by uuid NOT NULL,
  updated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT reglements_pkey PRIMARY KEY (id),
  CONSTRAINT reglements_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT reglements_tiers_id_fkey FOREIGN KEY (tiers_id) REFERENCES public.tiers(id),
  CONSTRAINT reglements_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id),
  CONSTRAINT reglements_mode_reglement_id_fkey FOREIGN KEY (mode_reglement_id) REFERENCES public.modes_reglement(id),
  CONSTRAINT reglements_ecriture_id_fkey FOREIGN KEY (ecriture_id) REFERENCES public.ecritures(id),
  CONSTRAINT reglements_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT reglements_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.taux_tva (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  taux numeric NOT NULL,
  compte_collectee character varying,
  compte_deductible character varying,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT taux_tva_pkey PRIMARY KEY (id),
  CONSTRAINT taux_tva_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id)
);
CREATE TABLE public.tiers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entreprise_id uuid NOT NULL,
  code character varying NOT NULL,
  type USER-DEFINED NOT NULL,
  raison_sociale character varying,
  nom character varying,
  prenom character varying,
  siret character varying,
  numero_tva_intra character varying,
  adresse text,
  code_postal character varying,
  ville character varying,
  pays character varying DEFAULT 'France'::character varying,
  telephone character varying,
  mobile character varying,
  email character varying,
  site_web character varying,
  compte_client character varying,
  compte_fournisseur character varying,
  mode_reglement_id uuid,
  delai_paiement_jours integer DEFAULT 30,
  encours_max numeric,
  notes text,
  tags jsonb DEFAULT '[]'::jsonb,
  actif boolean NOT NULL DEFAULT true,
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT tiers_pkey PRIMARY KEY (id),
  CONSTRAINT tiers_entreprise_id_fkey FOREIGN KEY (entreprise_id) REFERENCES public.entreprises(id),
  CONSTRAINT tiers_mode_reglement_id_fkey FOREIGN KEY (mode_reglement_id) REFERENCES public.modes_reglement(id),
  CONSTRAINT tiers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT tiers_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL UNIQUE,
  mot_de_passe_hash text NOT NULL,
  nom character varying NOT NULL,
  prenom character varying NOT NULL,
  role USER-DEFINED NOT NULL DEFAULT 'stagiaire'::user_role,
  metier USER-DEFINED,
  actif boolean NOT NULL DEFAULT true,
  derniere_connexion timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id)
);