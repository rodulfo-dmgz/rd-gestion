-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.absences (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  employe_id uuid NOT NULL,
  type_absence_id uuid NOT NULL,
  date_debut date NOT NULL,
  date_fin date NOT NULL,
  nb_jours numeric,
  motif text,
  statut character varying DEFAULT 'demandee'::character varying CHECK (statut::text = ANY (ARRAY['demandee'::character varying, 'validee'::character varying, 'refusee'::character varying, 'annulee'::character varying]::text[])),
  justificatif_url text,
  validated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT absences_pkey PRIMARY KEY (id),
  CONSTRAINT absences_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT absences_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT absences_type_absence_id_fkey FOREIGN KEY (type_absence_id) REFERENCES public.types_absence(id),
  CONSTRAINT absences_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id)
);
CREATE TABLE public.activites (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  type character varying NOT NULL,
  objet character varying NOT NULL,
  description text,
  date_debut timestamp with time zone NOT NULL,
  date_fin timestamp with time zone,
  statut character varying DEFAULT 'planifiee'::character varying CHECK (statut::text = ANY (ARRAY['planifiee'::character varying, 'en_cours'::character varying, 'terminee'::character varying, 'annulee'::character varying]::text[])),
  priorite character varying DEFAULT 'normale'::character varying CHECK (priorite::text = ANY (ARRAY['basse'::character varying, 'normale'::character varying, 'haute'::character varying, 'urgente'::character varying]::text[])),
  client_id uuid,
  prospect_id uuid,
  contact_id uuid,
  opportunite_id uuid,
  campagne_id uuid,
  assigned_to uuid,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT activites_pkey PRIMARY KEY (id),
  CONSTRAINT activites_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT activites_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT activites_prospect_id_fkey FOREIGN KEY (prospect_id) REFERENCES public.prospects(id),
  CONSTRAINT activites_contact_id_fkey FOREIGN KEY (contact_id) REFERENCES public.contacts(id),
  CONSTRAINT activites_opportunite_id_fkey FOREIGN KEY (opportunite_id) REFERENCES public.opportunites(id),
  CONSTRAINT activites_campagne_id_fkey FOREIGN KEY (campagne_id) REFERENCES public.campagnes(id),
  CONSTRAINT activites_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id),
  CONSTRAINT activites_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.annuaire (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  categorie character varying NOT NULL,
  nom character varying NOT NULL,
  prenom character varying,
  organisme character varying,
  fonction character varying,
  telephone character varying,
  email character varying,
  adresse text,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT annuaire_pkey PRIMARY KEY (id),
  CONSTRAINT annuaire_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.archives (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  document_id uuid,
  description character varying NOT NULL,
  categorie character varying,
  date_archivage date NOT NULL,
  duree_conservation_mois integer NOT NULL,
  date_destruction_prevue date,
  lieu_stockage character varying,
  reference_boite character varying,
  statut character varying DEFAULT 'archive'::character varying CHECK (statut::text = ANY (ARRAY['archive'::character varying, 'consulte'::character varying, 'detruit'::character varying]::text[])),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT archives_pkey PRIMARY KEY (id),
  CONSTRAINT archives_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT archives_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.documents(id)
);
CREATE TABLE public.attestations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  employe_id uuid NOT NULL,
  type_attestation character varying NOT NULL,
  date_emission date NOT NULL,
  motif character varying,
  contenu text,
  document_url text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT attestations_pkey PRIMARY KEY (id),
  CONSTRAINT attestations_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT attestations_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT attestations_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.avoirs_achat (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_avoir character varying NOT NULL,
  facture_origine_id uuid,
  fournisseur_id uuid NOT NULL,
  date_avoir date NOT NULL,
  motif text,
  montant_ht numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL DEFAULT 0,
  statut character varying NOT NULL DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'valide'::character varying, 'annule'::character varying]::text[])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT avoirs_achat_pkey PRIMARY KEY (id),
  CONSTRAINT avoirs_achat_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT avoirs_achat_facture_origine_id_fkey FOREIGN KEY (facture_origine_id) REFERENCES public.factures_achat(id),
  CONSTRAINT avoirs_achat_fournisseur_id_fkey FOREIGN KEY (fournisseur_id) REFERENCES public.fournisseurs(id),
  CONSTRAINT avoirs_achat_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.avoirs_vente (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_avoir character varying NOT NULL,
  facture_origine_id uuid,
  client_id uuid NOT NULL,
  date_avoir date NOT NULL,
  motif text,
  montant_ht numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL DEFAULT 0,
  statut character varying NOT NULL DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'valide'::character varying, 'annule'::character varying]::text[])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT avoirs_vente_pkey PRIMARY KEY (id),
  CONSTRAINT avoirs_vente_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT avoirs_vente_facture_origine_id_fkey FOREIGN KEY (facture_origine_id) REFERENCES public.factures_vente(id),
  CONSTRAINT avoirs_vente_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT avoirs_vente_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.banques (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  nom_banque character varying,
  iban character varying,
  bic character varying,
  compte_comptable_id uuid,
  solde_initial numeric DEFAULT 0,
  devise_id uuid,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT banques_pkey PRIMARY KEY (id),
  CONSTRAINT banques_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT banques_compte_comptable_id_fkey FOREIGN KEY (compte_comptable_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT banques_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id)
);
CREATE TABLE public.bulletins_paie (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  employe_id uuid NOT NULL,
  contrat_id uuid,
  periode character varying NOT NULL,
  date_debut_periode date NOT NULL,
  date_fin_periode date NOT NULL,
  salaire_brut numeric NOT NULL,
  total_cotisations_salariales numeric NOT NULL DEFAULT 0,
  total_cotisations_patronales numeric NOT NULL DEFAULT 0,
  net_imposable numeric,
  net_a_payer numeric NOT NULL,
  heures_travaillees numeric DEFAULT 151.67,
  heures_supplementaires numeric DEFAULT 0,
  statut character varying DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'valide'::character varying, 'envoye'::character varying, 'paye'::character varying]::text[])),
  bulletin_url text,
  validated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT bulletins_paie_pkey PRIMARY KEY (id),
  CONSTRAINT bulletins_paie_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT bulletins_paie_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT bulletins_paie_contrat_id_fkey FOREIGN KEY (contrat_id) REFERENCES public.contrats_travail(id),
  CONSTRAINT bulletins_paie_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id)
);
CREATE TABLE public.campagnes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_campagne character varying NOT NULL,
  libelle character varying NOT NULL,
  type character varying,
  date_debut date,
  date_fin date,
  budget numeric,
  statut character varying DEFAULT 'planifiee'::character varying CHECK (statut::text = ANY (ARRAY['planifiee'::character varying, 'en_cours'::character varying, 'terminee'::character varying, 'annulee'::character varying]::text[])),
  notes text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT campagnes_pkey PRIMARY KEY (id),
  CONSTRAINT campagnes_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT campagnes_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.candidatures (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  offre_emploi_id uuid,
  tenant_id uuid NOT NULL,
  civilite character varying,
  nom character varying NOT NULL,
  prenom character varying NOT NULL,
  email character varying,
  telephone character varying,
  date_candidature date NOT NULL,
  cv_url text,
  lettre_motivation_url text,
  source character varying,
  statut character varying DEFAULT 'recue'::character varying CHECK (statut::text = ANY (ARRAY['recue'::character varying, 'preselection'::character varying, 'entretien'::character varying, 'retenue'::character varying, 'rejetee'::character varying, 'vivier'::character varying]::text[])),
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT candidatures_pkey PRIMARY KEY (id),
  CONSTRAINT candidatures_offre_emploi_id_fkey FOREIGN KEY (offre_emploi_id) REFERENCES public.offres_emploi(id),
  CONSTRAINT candidatures_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.categories_immobilisations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  libelle character varying NOT NULL,
  duree_amortissement_defaut integer,
  methode_defaut_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT categories_immobilisations_pkey PRIMARY KEY (id),
  CONSTRAINT categories_immobilisations_methode_defaut_id_fkey FOREIGN KEY (methode_defaut_id) REFERENCES public.methodes_amortissement(id)
);
CREATE TABLE public.categories_produits (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  description text,
  parent_id uuid,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT categories_produits_pkey PRIMARY KEY (id),
  CONSTRAINT categories_produits_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT categories_produits_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.categories_produits(id)
);
CREATE TABLE public.clients (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_client character varying NOT NULL,
  raison_sociale character varying NOT NULL,
  forme_juridique character varying,
  siret character varying,
  tva_intra character varying,
  adresse text,
  complement_adresse text,
  code_postal character varying,
  ville character varying,
  pays character varying DEFAULT 'France'::character varying,
  telephone character varying,
  email character varying,
  site_web character varying,
  mode_reglement_id uuid,
  delai_paiement integer DEFAULT 30,
  encours_max numeric,
  devise_id uuid,
  compte_comptable_id uuid,
  assigned_to uuid,
  prospect_origine_id uuid,
  actif boolean NOT NULL DEFAULT true,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT clients_pkey PRIMARY KEY (id),
  CONSTRAINT clients_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT clients_mode_reglement_id_fkey FOREIGN KEY (mode_reglement_id) REFERENCES public.modes_reglement(id),
  CONSTRAINT clients_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id),
  CONSTRAINT clients_compte_comptable_id_fkey FOREIGN KEY (compte_comptable_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT clients_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id),
  CONSTRAINT clients_prospect_origine_id_fkey FOREIGN KEY (prospect_origine_id) REFERENCES public.prospects(id)
);
CREATE TABLE public.commandes_achat (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_commande character varying NOT NULL,
  fournisseur_id uuid NOT NULL,
  date_commande date NOT NULL,
  date_livraison_prevue date,
  objet character varying,
  montant_ht numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL DEFAULT 0,
  devise_id uuid,
  statut character varying NOT NULL DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'envoyee'::character varying, 'confirmee'::character varying, 'receptionnee'::character varying, 'facturee'::character varying, 'annulee'::character varying]::text[])),
  commentaire text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT commandes_achat_pkey PRIMARY KEY (id),
  CONSTRAINT commandes_achat_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT commandes_achat_fournisseur_id_fkey FOREIGN KEY (fournisseur_id) REFERENCES public.fournisseurs(id),
  CONSTRAINT commandes_achat_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id),
  CONSTRAINT commandes_achat_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.commandes_fournitures (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  fourniture_id uuid NOT NULL,
  quantite numeric NOT NULL,
  date_commande date NOT NULL,
  date_reception date,
  fournisseur character varying,
  statut character varying DEFAULT 'commandee'::character varying CHECK (statut::text = ANY (ARRAY['commandee'::character varying, 'recue'::character varying, 'annulee'::character varying]::text[])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT commandes_fournitures_pkey PRIMARY KEY (id),
  CONSTRAINT commandes_fournitures_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT commandes_fournitures_fourniture_id_fkey FOREIGN KEY (fourniture_id) REFERENCES public.fournitures(id),
  CONSTRAINT commandes_fournitures_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.commandes_vente (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_commande character varying NOT NULL,
  client_id uuid NOT NULL,
  devis_id uuid,
  contact_id uuid,
  date_commande date NOT NULL,
  date_livraison_prevue date,
  objet character varying,
  montant_ht numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL DEFAULT 0,
  devise_id uuid,
  statut character varying NOT NULL DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'confirmee'::character varying, 'en_preparation'::character varying, 'livree'::character varying, 'facturee'::character varying, 'annulee'::character varying]::text[])),
  commentaire text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT commandes_vente_pkey PRIMARY KEY (id),
  CONSTRAINT commandes_vente_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id),
  CONSTRAINT commandes_vente_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT commandes_vente_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT commandes_vente_devis_id_fkey FOREIGN KEY (devis_id) REFERENCES public.devis(id),
  CONSTRAINT commandes_vente_contact_id_fkey FOREIGN KEY (contact_id) REFERENCES public.contacts(id),
  CONSTRAINT commandes_vente_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.comptes_rendus (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  evenement_id uuid,
  titre character varying NOT NULL,
  contenu text NOT NULL,
  date_reunion date NOT NULL,
  participants text,
  decisions text,
  actions_a_suivre text,
  document_url text,
  redacteur_id uuid,
  statut character varying DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'valide'::character varying, 'diffuse'::character varying]::text[])),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT comptes_rendus_pkey PRIMARY KEY (id),
  CONSTRAINT comptes_rendus_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT comptes_rendus_evenement_id_fkey FOREIGN KEY (evenement_id) REFERENCES public.evenements(id),
  CONSTRAINT comptes_rendus_redacteur_id_fkey FOREIGN KEY (redacteur_id) REFERENCES public.users(id)
);
CREATE TABLE public.contacts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  client_id uuid,
  prospect_id uuid,
  fournisseur_id uuid,
  civilite character varying,
  prenom character varying,
  nom character varying NOT NULL,
  fonction character varying,
  telephone_fixe character varying,
  telephone_mobile character varying,
  email character varying,
  linkedin character varying,
  principal boolean DEFAULT false,
  date_naissance date,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT contacts_pkey PRIMARY KEY (id),
  CONSTRAINT contacts_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT contacts_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT contacts_prospect_id_fkey FOREIGN KEY (prospect_id) REFERENCES public.prospects(id),
  CONSTRAINT contacts_fournisseur_id_fkey FOREIGN KEY (fournisseur_id) REFERENCES public.fournisseurs(id)
);
CREATE TABLE public.contrats_travail (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  employe_id uuid NOT NULL,
  type_contrat character varying NOT NULL CHECK (type_contrat::text = ANY (ARRAY['CDI'::character varying, 'CDD'::character varying, 'CTT'::character varying, 'apprentissage'::character varying, 'professionnalisation'::character varying, 'stage'::character varying, 'interim'::character varying]::text[])),
  date_debut date NOT NULL,
  date_fin date,
  date_fin_periode_essai date,
  motif_cdd character varying,
  poste character varying NOT NULL,
  qualification character varying,
  classification character varying,
  coefficient character varying,
  echelon character varying,
  salaire_brut_mensuel numeric,
  salaire_base numeric,
  temps_travail character varying DEFAULT 'temps_plein'::character varying CHECK (temps_travail::text = ANY (ARRAY['temps_plein'::character varying, 'temps_partiel'::character varying]::text[])),
  duree_hebdo numeric DEFAULT 35,
  taux_activite numeric DEFAULT 100,
  avantages_nature text,
  lieu_travail character varying,
  convention_collective character varying,
  mutuelle_obligatoire boolean DEFAULT true,
  prevoyance boolean DEFAULT true,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT contrats_travail_pkey PRIMARY KEY (id),
  CONSTRAINT contrats_travail_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT contrats_travail_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id)
);
CREATE TABLE public.cotisations_sociales (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  libelle character varying NOT NULL,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['salariale'::character varying, 'patronale'::character varying]::text[])),
  base_calcul character varying,
  taux numeric NOT NULL,
  plafond_applicable boolean DEFAULT false,
  date_effet date NOT NULL,
  date_fin date,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT cotisations_sociales_pkey PRIMARY KEY (id)
);
CREATE TABLE public.courrier (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['entrant'::character varying, 'sortant'::character varying]::text[])),
  date_courrier date NOT NULL,
  date_reception date,
  expediteur character varying,
  destinataire character varying,
  objet character varying NOT NULL,
  reference character varying,
  categorie character varying,
  urgent boolean DEFAULT false,
  confidentiel boolean DEFAULT false,
  statut character varying DEFAULT 'recu'::character varying CHECK (statut::text = ANY (ARRAY['recu'::character varying, 'en_traitement'::character varying, 'traite'::character varying, 'archive'::character varying, 'envoye'::character varying]::text[])),
  document_url text,
  notes text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT courrier_pkey PRIMARY KEY (id),
  CONSTRAINT courrier_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT courrier_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.declarations_das2 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  annee integer NOT NULL,
  beneficiaire_nom character varying NOT NULL,
  beneficiaire_siret character varying,
  beneficiaire_adresse text,
  nature_prestation character varying,
  montant numeric NOT NULL,
  tva numeric,
  net_verse numeric,
  statut character varying DEFAULT 'brouillon'::character varying,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT declarations_das2_pkey PRIMARY KEY (id),
  CONSTRAINT declarations_das2_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT declarations_das2_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.declarations_is (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  exercice_id uuid,
  annee integer NOT NULL,
  resultat_fiscal numeric,
  is_calcule numeric,
  acomptes_verses numeric DEFAULT 0,
  solde_a_payer numeric,
  date_limite date,
  statut character varying DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'calculee'::character varying, 'declaree'::character varying, 'payee'::character varying]::text[])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT declarations_is_pkey PRIMARY KEY (id),
  CONSTRAINT declarations_is_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT declarations_is_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices_comptables(id),
  CONSTRAINT declarations_is_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.declarations_tva (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  exercice_id uuid,
  type_declaration character varying NOT NULL DEFAULT 'CA3'::character varying CHECK (type_declaration::text = ANY (ARRAY['CA3'::character varying, 'CA12'::character varying]::text[])),
  periode character varying NOT NULL,
  date_limite date,
  tva_collectee numeric NOT NULL DEFAULT 0,
  tva_deductible numeric NOT NULL DEFAULT 0,
  tva_nette numeric NOT NULL DEFAULT 0,
  credit_tva numeric DEFAULT 0,
  statut character varying DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'validee'::character varying, 'teledeclaree'::character varying, 'payee'::character varying]::text[])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT declarations_tva_pkey PRIMARY KEY (id),
  CONSTRAINT declarations_tva_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT declarations_tva_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices_comptables(id),
  CONSTRAINT declarations_tva_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.deplacements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  employe_id uuid,
  user_id uuid,
  motif character varying NOT NULL,
  destination character varying NOT NULL,
  date_depart date NOT NULL,
  date_retour date,
  moyen_transport character varying,
  distance_km numeric,
  cout_estime numeric,
  statut character varying DEFAULT 'demande'::character varying CHECK (statut::text = ANY (ARRAY['demande'::character varying, 'valide'::character varying, 'en_cours'::character varying, 'termine'::character varying, 'annule'::character varying]::text[])),
  validated_by uuid,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT deplacements_pkey PRIMARY KEY (id),
  CONSTRAINT deplacements_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT deplacements_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT deplacements_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT deplacements_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id)
);
CREATE TABLE public.devis (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_devis character varying NOT NULL,
  client_id uuid,
  prospect_id uuid,
  contact_id uuid,
  date_devis date NOT NULL,
  date_validite date,
  objet character varying,
  montant_ht numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL DEFAULT 0,
  devise_id uuid,
  statut character varying NOT NULL DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'envoye'::character varying, 'accepte'::character varying, 'refuse'::character varying, 'expire'::character varying, 'annule'::character varying]::text[])),
  commentaire text,
  created_by uuid,
  validated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT devis_pkey PRIMARY KEY (id),
  CONSTRAINT devis_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT devis_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT devis_prospect_id_fkey FOREIGN KEY (prospect_id) REFERENCES public.prospects(id),
  CONSTRAINT devis_contact_id_fkey FOREIGN KEY (contact_id) REFERENCES public.contacts(id),
  CONSTRAINT devis_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id),
  CONSTRAINT devis_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT devis_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id)
);
CREATE TABLE public.devises (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  libelle character varying NOT NULL,
  symbole character varying,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT devises_pkey PRIMARY KEY (id)
);
CREATE TABLE public.diplomes_certifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  employe_id uuid NOT NULL,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['diplome'::character varying, 'certification'::character varying, 'habilitation'::character varying, 'permis'::character varying]::text[])),
  intitule character varying NOT NULL,
  organisme character varying,
  date_obtention date,
  date_expiration date,
  numero character varying,
  niveau character varying,
  document_url text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT diplomes_certifications_pkey PRIMARY KEY (id),
  CONSTRAINT diplomes_certifications_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id)
);
CREATE TABLE public.documents (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  titre character varying NOT NULL,
  description text,
  categorie character varying,
  type_document character varying,
  fichier_url text NOT NULL,
  taille_octets bigint,
  version integer DEFAULT 1,
  confidentiel boolean DEFAULT false,
  client_id uuid,
  fournisseur_id uuid,
  employe_id uuid,
  tags text,
  uploaded_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT documents_pkey PRIMARY KEY (id),
  CONSTRAINT documents_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT documents_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT documents_fournisseur_id_fkey FOREIGN KEY (fournisseur_id) REFERENCES public.fournisseurs(id),
  CONSTRAINT documents_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(id)
);
CREATE TABLE public.dotations_amortissement (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  immobilisation_id uuid NOT NULL,
  exercice_id uuid NOT NULL,
  annee integer NOT NULL,
  dotation_exercice numeric NOT NULL,
  cumul_amortissement numeric NOT NULL,
  valeur_nette numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT dotations_amortissement_pkey PRIMARY KEY (id),
  CONSTRAINT dotations_amortissement_immobilisation_id_fkey FOREIGN KEY (immobilisation_id) REFERENCES public.immobilisations(id),
  CONSTRAINT dotations_amortissement_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices_comptables(id)
);
CREATE TABLE public.dsn_en_tetes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  type_dsn character varying NOT NULL,
  periode character varying NOT NULL,
  date_generation timestamp with time zone,
  date_envoi timestamp with time zone,
  numero_envoi character varying,
  statut character varying DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'generee'::character varying, 'envoyee'::character varying, 'acceptee'::character varying, 'rejetee'::character varying]::text[])),
  fichier_url text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT dsn_en_tetes_pkey PRIMARY KEY (id),
  CONSTRAINT dsn_en_tetes_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT dsn_en_tetes_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.dsn_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  dsn_id uuid NOT NULL,
  employe_id uuid,
  type_message character varying NOT NULL,
  contenu text,
  statut character varying DEFAULT 'genere'::character varying,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT dsn_messages_pkey PRIMARY KEY (id),
  CONSTRAINT dsn_messages_dsn_id_fkey FOREIGN KEY (dsn_id) REFERENCES public.dsn_en_tetes(id),
  CONSTRAINT dsn_messages_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id)
);
CREATE TABLE public.echeanciers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['client'::character varying, 'fournisseur'::character varying]::text[])),
  facture_vente_id uuid,
  facture_achat_id uuid,
  date_echeance date NOT NULL,
  montant numeric NOT NULL,
  statut character varying DEFAULT 'a_venir'::character varying CHECK (statut::text = ANY (ARRAY['a_venir'::character varying, 'payee'::character varying, 'en_retard'::character varying, 'annulee'::character varying]::text[])),
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT echeanciers_pkey PRIMARY KEY (id),
  CONSTRAINT echeanciers_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT echeanciers_facture_vente_id_fkey FOREIGN KEY (facture_vente_id) REFERENCES public.factures_vente(id),
  CONSTRAINT echeanciers_facture_achat_id_fkey FOREIGN KEY (facture_achat_id) REFERENCES public.factures_achat(id)
);
CREATE TABLE public.ecritures_comptables (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  journal_id uuid NOT NULL,
  exercice_id uuid NOT NULL,
  numero_piece character varying NOT NULL,
  date_piece date NOT NULL,
  libelle character varying NOT NULL,
  compte_id uuid NOT NULL,
  debit numeric NOT NULL DEFAULT 0,
  credit numeric NOT NULL DEFAULT 0,
  devise_id uuid,
  montant_devise numeric,
  lettre character varying,
  date_lettrage date,
  pointe boolean DEFAULT false,
  facture_vente_id uuid,
  facture_achat_id uuid,
  mouvement_bancaire_id uuid,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT ecritures_comptables_pkey PRIMARY KEY (id),
  CONSTRAINT ecritures_comptables_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id),
  CONSTRAINT ecritures_comptables_facture_vente_id_fkey FOREIGN KEY (facture_vente_id) REFERENCES public.factures_vente(id),
  CONSTRAINT ecritures_comptables_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT ecritures_comptables_journal_id_fkey FOREIGN KEY (journal_id) REFERENCES public.journaux(id),
  CONSTRAINT ecritures_comptables_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices_comptables(id),
  CONSTRAINT ecritures_comptables_compte_id_fkey FOREIGN KEY (compte_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT ecritures_comptables_facture_achat_id_fkey FOREIGN KEY (facture_achat_id) REFERENCES public.factures_achat(id),
  CONSTRAINT ecritures_comptables_mouvement_bancaire_id_fkey FOREIGN KEY (mouvement_bancaire_id) REFERENCES public.mouvements_bancaires(id),
  CONSTRAINT ecritures_comptables_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.employes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  auth_user_id uuid UNIQUE,
  matricule character varying NOT NULL,
  civilite character varying,
  nom_naissance character varying NOT NULL,
  nom_usage character varying,
  prenom character varying NOT NULL,
  prenom2 character varying,
  date_naissance date NOT NULL,
  lieu_naissance character varying,
  departement_naissance character varying,
  pays_naissance character varying DEFAULT 'France'::character varying,
  nationalite character varying NOT NULL DEFAULT 'Fran√ßaise'::character varying,
  nationalite2 character varying,
  titre_sejour_type character varying,
  titre_sejour_numero character varying,
  titre_sejour_date_debut date,
  titre_sejour_date_fin date,
  autorisation_travail boolean DEFAULT true,
  numero_ss character varying NOT NULL,
  numero_ss_provisoire boolean DEFAULT false,
  situation_familiale character varying DEFAULT 'celibataire'::character varying CHECK (situation_familiale::text = ANY (ARRAY['celibataire'::character varying, 'marie'::character varying, 'pacse'::character varying, 'divorce'::character varying, 'veuf'::character varying, 'separe'::character varying, 'concubin'::character varying]::text[])),
  nombre_enfants integer DEFAULT 0,
  adresse text,
  complement_adresse text,
  code_postal character varying,
  ville character varying,
  pays character varying DEFAULT 'France'::character varying,
  telephone character varying,
  telephone_perso character varying,
  email_pro character varying,
  email_perso character varying,
  contact_urgence_nom character varying,
  contact_urgence_tel character varying,
  contact_urgence_lien character varying,
  niveau_etudes character varying,
  dernier_diplome character varying,
  etablissement_diplome character varying,
  annee_diplome integer,
  date_entree date NOT NULL,
  date_sortie date,
  motif_sortie character varying,
  poste character varying,
  service character varying,
  categorie character varying,
  coefficient character varying,
  echelon character varying,
  photo_url text,
  actif boolean NOT NULL DEFAULT true,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT employes_pkey PRIMARY KEY (id),
  CONSTRAINT employes_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.entretiens (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  employe_id uuid NOT NULL,
  type_entretien character varying NOT NULL CHECK (type_entretien::text = ANY (ARRAY['professionnel'::character varying, 'annuel'::character varying, 'mi_annuel'::character varying, 'fin_pe'::character varying, 'recadrage'::character varying]::text[])),
  date_entretien date NOT NULL,
  evaluateur_id uuid,
  compte_rendu text,
  objectifs text,
  commentaire_employe text,
  statut character varying DEFAULT 'planifie'::character varying CHECK (statut::text = ANY (ARRAY['planifie'::character varying, 'realise'::character varying, 'annule'::character varying]::text[])),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT entretiens_pkey PRIMARY KEY (id),
  CONSTRAINT entretiens_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT entretiens_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT entretiens_evaluateur_id_fkey FOREIGN KEY (evaluateur_id) REFERENCES public.users(id)
);
CREATE TABLE public.evenements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  type character varying NOT NULL,
  libelle character varying NOT NULL,
  description text,
  date_debut timestamp with time zone NOT NULL,
  date_fin timestamp with time zone,
  lieu character varying,
  local_id uuid,
  organisateur_id uuid,
  budget numeric,
  statut character varying DEFAULT 'planifie'::character varying CHECK (statut::text = ANY (ARRAY['planifie'::character varying, 'confirme'::character varying, 'en_cours'::character varying, 'termine'::character varying, 'annule'::character varying]::text[])),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT evenements_pkey PRIMARY KEY (id),
  CONSTRAINT evenements_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT evenements_local_id_fkey FOREIGN KEY (local_id) REFERENCES public.locaux(id),
  CONSTRAINT evenements_organisateur_id_fkey FOREIGN KEY (organisateur_id) REFERENCES public.users(id)
);
CREATE TABLE public.exercices_comptables (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  annee integer NOT NULL,
  date_debut date NOT NULL,
  date_fin date NOT NULL,
  cloture boolean NOT NULL DEFAULT false,
  date_cloture date,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT exercices_comptables_pkey PRIMARY KEY (id),
  CONSTRAINT exercices_comptables_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.factures_achat (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  numero_facture character varying NOT NULL,
  fournisseur_id uuid NOT NULL,
  commande_achat_id uuid,
  date_facture date NOT NULL,
  date_echeance date,
  mode_reglement_id uuid,
  statut character varying NOT NULL DEFAULT 'recue'::character varying CHECK (statut::text = ANY (ARRAY['recue'::character varying, 'validee'::character varying, 'comptabilisee'::character varying, 'payee'::character varying, 'partiellement_payee'::character varying, 'litige'::character varying, 'annulee'::character varying]::text[])),
  objet character varying,
  montant_ht numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL DEFAULT 0,
  net_a_payer numeric NOT NULL DEFAULT 0,
  montant_regle numeric NOT NULL DEFAULT 0,
  reste_a_payer numeric NOT NULL DEFAULT 0,
  devise_id uuid,
  commentaire text,
  created_by uuid,
  validated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT factures_achat_pkey PRIMARY KEY (id),
  CONSTRAINT factures_achat_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT factures_achat_fournisseur_id_fkey FOREIGN KEY (fournisseur_id) REFERENCES public.fournisseurs(id),
  CONSTRAINT factures_achat_commande_achat_id_fkey FOREIGN KEY (commande_achat_id) REFERENCES public.commandes_achat(id),
  CONSTRAINT factures_achat_mode_reglement_id_fkey FOREIGN KEY (mode_reglement_id) REFERENCES public.modes_reglement(id),
  CONSTRAINT factures_achat_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id),
  CONSTRAINT factures_achat_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT factures_achat_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id)
);
CREATE TABLE public.factures_vente (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_facture character varying NOT NULL,
  client_id uuid NOT NULL,
  commande_vente_id uuid,
  contact_id uuid,
  date_facture date NOT NULL,
  date_echeance date,
  mode_reglement_id uuid,
  statut character varying NOT NULL DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'validee'::character varying, 'envoyee'::character varying, 'payee'::character varying, 'partiellement_payee'::character varying, 'impayee'::character varying, 'annulee'::character varying]::text[])),
  objet character varying,
  montant_ht numeric NOT NULL DEFAULT 0,
  montant_tva numeric NOT NULL DEFAULT 0,
  montant_ttc numeric NOT NULL DEFAULT 0,
  net_a_payer numeric NOT NULL DEFAULT 0,
  montant_regle numeric NOT NULL DEFAULT 0,
  reste_a_payer numeric NOT NULL DEFAULT 0,
  devise_id uuid,
  commentaire text,
  created_by uuid,
  validated_by uuid,
  date_validation timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT factures_vente_pkey PRIMARY KEY (id),
  CONSTRAINT factures_vente_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT factures_vente_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT factures_vente_commande_vente_id_fkey FOREIGN KEY (commande_vente_id) REFERENCES public.commandes_vente(id),
  CONSTRAINT factures_vente_contact_id_fkey FOREIGN KEY (contact_id) REFERENCES public.contacts(id),
  CONSTRAINT factures_vente_mode_reglement_id_fkey FOREIGN KEY (mode_reglement_id) REFERENCES public.modes_reglement(id),
  CONSTRAINT factures_vente_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id),
  CONSTRAINT factures_vente_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT factures_vente_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id)
);
CREATE TABLE public.fichiers_fec (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  exercice_id uuid NOT NULL,
  date_generation timestamp with time zone NOT NULL DEFAULT now(),
  nom_fichier character varying NOT NULL,
  fichier_url text,
  nombre_ecritures integer,
  generated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT fichiers_fec_pkey PRIMARY KEY (id),
  CONSTRAINT fichiers_fec_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT fichiers_fec_exercice_id_fkey FOREIGN KEY (exercice_id) REFERENCES public.exercices_comptables(id),
  CONSTRAINT fichiers_fec_generated_by_fkey FOREIGN KEY (generated_by) REFERENCES public.users(id)
);
CREATE TABLE public.formations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_formation character varying NOT NULL,
  libelle character varying NOT NULL,
  organisme character varying,
  date_debut date,
  date_fin date,
  duree_heures numeric,
  cout_ht numeric,
  lieu character varying,
  type_formation character varying,
  statut character varying DEFAULT 'planifiee'::character varying,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT formations_pkey PRIMARY KEY (id),
  CONSTRAINT formations_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.fournisseurs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_fournisseur character varying NOT NULL,
  raison_sociale character varying NOT NULL,
  forme_juridique character varying,
  siret character varying,
  tva_intra character varying,
  adresse text,
  code_postal character varying,
  ville character varying,
  pays character varying DEFAULT 'France'::character varying,
  telephone character varying,
  email character varying,
  site_web character varying,
  mode_reglement_id uuid,
  delai_paiement integer DEFAULT 30,
  devise_id uuid,
  compte_comptable_id uuid,
  actif boolean NOT NULL DEFAULT true,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT fournisseurs_pkey PRIMARY KEY (id),
  CONSTRAINT fournisseurs_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT fournisseurs_mode_reglement_id_fkey FOREIGN KEY (mode_reglement_id) REFERENCES public.modes_reglement(id),
  CONSTRAINT fournisseurs_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id),
  CONSTRAINT fournisseurs_compte_comptable_id_fkey FOREIGN KEY (compte_comptable_id) REFERENCES public.plan_comptable(id)
);
CREATE TABLE public.fournitures (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  categorie character varying,
  unite character varying DEFAULT 'pce'::character varying,
  stock_actuel numeric DEFAULT 0,
  stock_min numeric DEFAULT 0,
  prix_unitaire numeric,
  emplacement character varying,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT fournitures_pkey PRIMARY KEY (id),
  CONSTRAINT fournitures_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.immobilisations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  categorie_id uuid,
  date_acquisition date NOT NULL,
  date_mise_en_service date,
  valeur_acquisition numeric NOT NULL,
  valeur_residuelle numeric DEFAULT 0,
  duree_amortissement integer NOT NULL,
  methode_id uuid,
  compte_immo_id uuid,
  compte_amort_id uuid,
  compte_dotation_id uuid,
  fournisseur_id uuid,
  numero_serie character varying,
  localisation character varying,
  date_sortie date,
  motif_sortie character varying,
  valeur_cession numeric,
  actif boolean NOT NULL DEFAULT true,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT immobilisations_pkey PRIMARY KEY (id),
  CONSTRAINT immobilisations_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT immobilisations_categorie_id_fkey FOREIGN KEY (categorie_id) REFERENCES public.categories_immobilisations(id),
  CONSTRAINT immobilisations_methode_id_fkey FOREIGN KEY (methode_id) REFERENCES public.methodes_amortissement(id),
  CONSTRAINT immobilisations_compte_immo_id_fkey FOREIGN KEY (compte_immo_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT immobilisations_compte_amort_id_fkey FOREIGN KEY (compte_amort_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT immobilisations_compte_dotation_id_fkey FOREIGN KEY (compte_dotation_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT immobilisations_fournisseur_id_fkey FOREIGN KEY (fournisseur_id) REFERENCES public.fournisseurs(id)
);
CREATE TABLE public.inscriptions_formation (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  formation_id uuid NOT NULL,
  employe_id uuid NOT NULL,
  statut character varying DEFAULT 'inscrit'::character varying CHECK (statut::text = ANY (ARRAY['inscrit'::character varying, 'confirme'::character varying, 'present'::character varying, 'absent'::character varying, 'annule'::character varying]::text[])),
  note_evaluation numeric,
  commentaire text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT inscriptions_formation_pkey PRIMARY KEY (id),
  CONSTRAINT inscriptions_formation_formation_id_fkey FOREIGN KEY (formation_id) REFERENCES public.formations(id),
  CONSTRAINT inscriptions_formation_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id)
);
CREATE TABLE public.invitations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  evenement_id uuid NOT NULL,
  employe_id uuid,
  user_id uuid,
  email_externe character varying,
  nom_externe character varying,
  statut character varying DEFAULT 'invitee'::character varying CHECK (statut::text = ANY (ARRAY['invitee'::character varying, 'confirmee'::character varying, 'declinee'::character varying, 'presente'::character varying, 'absente'::character varying]::text[])),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT invitations_pkey PRIMARY KEY (id),
  CONSTRAINT invitations_evenement_id_fkey FOREIGN KEY (evenement_id) REFERENCES public.evenements(id),
  CONSTRAINT invitations_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT invitations_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.journaux (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  type character varying,
  compte_contrepartie_id uuid,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT journaux_pkey PRIMARY KEY (id),
  CONSTRAINT journaux_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT journaux_compte_contrepartie_id_fkey FOREIGN KEY (compte_contrepartie_id) REFERENCES public.plan_comptable(id)
);
CREATE TABLE public.lettres_lettrage (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  compte_id uuid NOT NULL,
  lettre character varying NOT NULL,
  date_lettrage date NOT NULL,
  montant numeric NOT NULL,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lettres_lettrage_pkey PRIMARY KEY (id),
  CONSTRAINT lettres_lettrage_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT lettres_lettrage_compte_id_fkey FOREIGN KEY (compte_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT lettres_lettrage_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.lignes_avoirs_achat (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  avoir_id uuid NOT NULL,
  ligne_numero integer NOT NULL,
  produit_service_id uuid,
  libelle character varying NOT NULL,
  quantite numeric NOT NULL DEFAULT 1,
  prix_unitaire_ht numeric NOT NULL,
  taux_tva numeric NOT NULL DEFAULT 20,
  montant_ht numeric NOT NULL,
  montant_tva numeric NOT NULL,
  montant_ttc numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_avoirs_achat_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_avoirs_achat_avoir_id_fkey FOREIGN KEY (avoir_id) REFERENCES public.avoirs_achat(id),
  CONSTRAINT lignes_avoirs_achat_produit_service_id_fkey FOREIGN KEY (produit_service_id) REFERENCES public.produits_services(id)
);
CREATE TABLE public.lignes_avoirs_vente (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  avoir_id uuid NOT NULL,
  ligne_numero integer NOT NULL,
  produit_service_id uuid,
  libelle character varying NOT NULL,
  quantite numeric NOT NULL DEFAULT 1,
  prix_unitaire_ht numeric NOT NULL,
  taux_tva numeric NOT NULL DEFAULT 20,
  montant_ht numeric NOT NULL,
  montant_tva numeric NOT NULL,
  montant_ttc numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_avoirs_vente_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_avoirs_vente_avoir_id_fkey FOREIGN KEY (avoir_id) REFERENCES public.avoirs_vente(id),
  CONSTRAINT lignes_avoirs_vente_produit_service_id_fkey FOREIGN KEY (produit_service_id) REFERENCES public.produits_services(id)
);
CREATE TABLE public.lignes_bulletins_paie (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  bulletin_id uuid NOT NULL,
  ordre integer NOT NULL,
  cotisation_id uuid,
  libelle character varying NOT NULL,
  base numeric,
  taux_salarial numeric,
  montant_salarial numeric,
  taux_patronal numeric,
  montant_patronal numeric,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_bulletins_paie_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_bulletins_paie_bulletin_id_fkey FOREIGN KEY (bulletin_id) REFERENCES public.bulletins_paie(id),
  CONSTRAINT lignes_bulletins_paie_cotisation_id_fkey FOREIGN KEY (cotisation_id) REFERENCES public.cotisations_sociales(id)
);
CREATE TABLE public.lignes_commandes_achat (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  commande_id uuid NOT NULL,
  ligne_numero integer NOT NULL,
  produit_service_id uuid,
  libelle character varying NOT NULL,
  description text,
  quantite numeric NOT NULL DEFAULT 1,
  prix_unitaire_ht numeric NOT NULL,
  taux_tva numeric NOT NULL DEFAULT 20,
  montant_ht numeric NOT NULL,
  montant_tva numeric NOT NULL,
  montant_ttc numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_commandes_achat_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_commandes_achat_commande_id_fkey FOREIGN KEY (commande_id) REFERENCES public.commandes_achat(id),
  CONSTRAINT lignes_commandes_achat_produit_service_id_fkey FOREIGN KEY (produit_service_id) REFERENCES public.produits_services(id)
);
CREATE TABLE public.lignes_commandes_vente (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  commande_id uuid NOT NULL,
  ligne_numero integer NOT NULL,
  produit_service_id uuid,
  libelle character varying NOT NULL,
  description text,
  quantite numeric NOT NULL DEFAULT 1,
  prix_unitaire_ht numeric NOT NULL,
  remise_pourcent numeric DEFAULT 0,
  taux_tva numeric NOT NULL DEFAULT 20,
  montant_ht numeric NOT NULL,
  montant_tva numeric NOT NULL,
  montant_ttc numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_commandes_vente_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_commandes_vente_commande_id_fkey FOREIGN KEY (commande_id) REFERENCES public.commandes_vente(id),
  CONSTRAINT lignes_commandes_vente_produit_service_id_fkey FOREIGN KEY (produit_service_id) REFERENCES public.produits_services(id)
);
CREATE TABLE public.lignes_devis (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  devis_id uuid NOT NULL,
  ligne_numero integer NOT NULL,
  produit_service_id uuid,
  libelle character varying NOT NULL,
  description text,
  quantite numeric NOT NULL DEFAULT 1,
  prix_unitaire_ht numeric NOT NULL,
  remise_pourcent numeric DEFAULT 0,
  taux_tva numeric NOT NULL DEFAULT 20,
  montant_ht numeric NOT NULL,
  montant_tva numeric NOT NULL,
  montant_ttc numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_devis_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_devis_devis_id_fkey FOREIGN KEY (devis_id) REFERENCES public.devis(id),
  CONSTRAINT lignes_devis_produit_service_id_fkey FOREIGN KEY (produit_service_id) REFERENCES public.produits_services(id)
);
CREATE TABLE public.lignes_factures_achat (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  facture_id uuid NOT NULL,
  ligne_numero integer NOT NULL,
  produit_service_id uuid,
  libelle character varying NOT NULL,
  description text,
  quantite numeric NOT NULL DEFAULT 1,
  prix_unitaire_ht numeric NOT NULL,
  taux_tva numeric NOT NULL DEFAULT 20,
  montant_ht numeric NOT NULL,
  montant_tva numeric NOT NULL,
  montant_ttc numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_factures_achat_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_factures_achat_facture_id_fkey FOREIGN KEY (facture_id) REFERENCES public.factures_achat(id),
  CONSTRAINT lignes_factures_achat_produit_service_id_fkey FOREIGN KEY (produit_service_id) REFERENCES public.produits_services(id)
);
CREATE TABLE public.lignes_factures_vente (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  facture_id uuid NOT NULL,
  ligne_numero integer NOT NULL,
  produit_service_id uuid,
  libelle character varying NOT NULL,
  description text,
  quantite numeric NOT NULL DEFAULT 1,
  prix_unitaire_ht numeric NOT NULL,
  remise_pourcent numeric DEFAULT 0,
  taux_tva numeric NOT NULL DEFAULT 20,
  montant_ht numeric NOT NULL,
  montant_tva numeric NOT NULL,
  montant_ttc numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_factures_vente_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_factures_vente_facture_id_fkey FOREIGN KEY (facture_id) REFERENCES public.factures_vente(id),
  CONSTRAINT lignes_factures_vente_produit_service_id_fkey FOREIGN KEY (produit_service_id) REFERENCES public.produits_services(id)
);
CREATE TABLE public.lignes_notes_frais (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  note_frais_id uuid NOT NULL,
  date_depense date NOT NULL,
  categorie character varying NOT NULL,
  description character varying NOT NULL,
  montant_ht numeric,
  montant_tva numeric,
  montant_ttc numeric NOT NULL,
  justificatif_url text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_notes_frais_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_notes_frais_note_frais_id_fkey FOREIGN KEY (note_frais_id) REFERENCES public.notes_frais(id)
);
CREATE TABLE public.lignes_rapprochement (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  rapprochement_id uuid NOT NULL,
  mouvement_bancaire_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT lignes_rapprochement_pkey PRIMARY KEY (id),
  CONSTRAINT lignes_rapprochement_rapprochement_id_fkey FOREIGN KEY (rapprochement_id) REFERENCES public.rapprochements_bancaires(id),
  CONSTRAINT lignes_rapprochement_mouvement_bancaire_id_fkey FOREIGN KEY (mouvement_bancaire_id) REFERENCES public.mouvements_bancaires(id)
);
CREATE TABLE public.listes_diffusion (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  nom character varying NOT NULL,
  description text,
  membres text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT listes_diffusion_pkey PRIMARY KEY (id),
  CONSTRAINT listes_diffusion_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT listes_diffusion_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.locaux (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  type character varying,
  adresse text,
  surface_m2 numeric,
  capacite integer,
  equipements text,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT locaux_pkey PRIMARY KEY (id),
  CONSTRAINT locaux_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.maintenance_interventions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  local_id uuid,
  type character varying NOT NULL,
  description text NOT NULL,
  date_demande date NOT NULL,
  date_intervention date,
  urgence character varying DEFAULT 'normale'::character varying CHECK (urgence::text = ANY (ARRAY['basse'::character varying, 'normale'::character varying, 'haute'::character varying, 'urgente'::character varying]::text[])),
  prestataire character varying,
  cout_estime numeric,
  cout_reel numeric,
  statut character varying DEFAULT 'demandee'::character varying CHECK (statut::text = ANY (ARRAY['demandee'::character varying, 'planifiee'::character varying, 'en_cours'::character varying, 'terminee'::character varying, 'annulee'::character varying]::text[])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT maintenance_interventions_pkey PRIMARY KEY (id),
  CONSTRAINT maintenance_interventions_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT maintenance_interventions_local_id_fkey FOREIGN KEY (local_id) REFERENCES public.locaux(id),
  CONSTRAINT maintenance_interventions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.methodes_amortissement (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  libelle character varying NOT NULL,
  description text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT methodes_amortissement_pkey PRIMARY KEY (id)
);
CREATE TABLE public.modeles_documents (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  categorie character varying,
  description text,
  contenu_template text,
  fichier_url text,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT modeles_documents_pkey PRIMARY KEY (id),
  CONSTRAINT modeles_documents_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.modes_reglement (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT modes_reglement_pkey PRIMARY KEY (id),
  CONSTRAINT modes_reglement_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.mouvements_bancaires (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  banque_id uuid NOT NULL,
  date_operation date NOT NULL,
  date_valeur date,
  libelle character varying NOT NULL,
  reference character varying,
  montant numeric NOT NULL,
  type_operation character varying,
  pointe boolean DEFAULT false,
  ecriture_id uuid,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT mouvements_bancaires_pkey PRIMARY KEY (id),
  CONSTRAINT mouvements_bancaires_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT mouvements_bancaires_banque_id_fkey FOREIGN KEY (banque_id) REFERENCES public.banques(id),
  CONSTRAINT mouvements_bancaires_ecriture_id_fkey FOREIGN KEY (ecriture_id) REFERENCES public.ecritures_comptables(id)
);
CREATE TABLE public.notes_frais (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_note character varying NOT NULL,
  employe_id uuid,
  date_note date NOT NULL,
  mois_concerne character varying,
  montant_total numeric NOT NULL DEFAULT 0,
  statut character varying DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'soumise'::character varying, 'validee'::character varying, 'remboursee'::character varying, 'rejetee'::character varying]::text[])),
  validated_by uuid,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT notes_frais_pkey PRIMARY KEY (id),
  CONSTRAINT notes_frais_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT notes_frais_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id),
  CONSTRAINT notes_frais_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id)
);
CREATE TABLE public.notes_service (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  reference character varying NOT NULL,
  objet character varying NOT NULL,
  contenu text NOT NULL,
  date_emission date NOT NULL,
  emetteur_id uuid,
  destinataires text,
  diffusion_liste_id uuid,
  document_url text,
  statut character varying DEFAULT 'brouillon'::character varying CHECK (statut::text = ANY (ARRAY['brouillon'::character varying, 'diffusee'::character varying, 'archivee'::character varying]::text[])),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT notes_service_pkey PRIMARY KEY (id),
  CONSTRAINT notes_service_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT notes_service_emetteur_id_fkey FOREIGN KEY (emetteur_id) REFERENCES public.users(id),
  CONSTRAINT notes_service_diffusion_liste_id_fkey FOREIGN KEY (diffusion_liste_id) REFERENCES public.listes_diffusion(id)
);
CREATE TABLE public.offres_emploi (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  reference character varying NOT NULL,
  poste character varying NOT NULL,
  service character varying,
  type_contrat character varying,
  description text,
  profil_recherche text,
  salaire_min numeric,
  salaire_max numeric,
  lieu character varying,
  date_publication date,
  date_cloture date,
  statut character varying DEFAULT 'ouverte'::character varying CHECK (statut::text = ANY (ARRAY['ouverte'::character varying, 'en_cours'::character varying, 'pourvue'::character varying, 'annulee'::character varying]::text[])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT offres_emploi_pkey PRIMARY KEY (id),
  CONSTRAINT offres_emploi_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT offres_emploi_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.opportunites (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_opportunite character varying NOT NULL,
  libelle character varying NOT NULL,
  client_id uuid,
  prospect_id uuid,
  contact_id uuid,
  montant_estime numeric,
  probabilite integer CHECK (probabilite >= 0 AND probabilite <= 100),
  statut character varying DEFAULT 'qualification'::character varying CHECK (statut::text = ANY (ARRAY['qualification'::character varying, 'proposition'::character varying, 'negociation'::character varying, 'gagnee'::character varying, 'perdue'::character varying]::text[])),
  date_cloture_prevue date,
  assigned_to uuid,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT opportunites_pkey PRIMARY KEY (id),
  CONSTRAINT opportunites_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT opportunites_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT opportunites_prospect_id_fkey FOREIGN KEY (prospect_id) REFERENCES public.prospects(id),
  CONSTRAINT opportunites_contact_id_fkey FOREIGN KEY (contact_id) REFERENCES public.contacts(id),
  CONSTRAINT opportunites_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id)
);
CREATE TABLE public.parametres_globaux (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  cle character varying NOT NULL,
  valeur text,
  type character varying DEFAULT 'string'::character varying,
  description text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT parametres_globaux_pkey PRIMARY KEY (id),
  CONSTRAINT parametres_globaux_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.parcours_integration (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  employe_id uuid NOT NULL,
  etape character varying NOT NULL,
  responsable_id uuid,
  date_prevue date,
  date_realisee date,
  statut character varying DEFAULT 'a_faire'::character varying CHECK (statut::text = ANY (ARRAY['a_faire'::character varying, 'en_cours'::character varying, 'fait'::character varying, 'annule'::character varying]::text[])),
  commentaire text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT parcours_integration_pkey PRIMARY KEY (id),
  CONSTRAINT parcours_integration_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT parcours_integration_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT parcours_integration_responsable_id_fkey FOREIGN KEY (responsable_id) REFERENCES public.users(id)
);
CREATE TABLE public.permissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  libelle character varying NOT NULL,
  module character varying,
  description text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT permissions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.plan_comptable (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  numero_compte character varying NOT NULL,
  intitule character varying NOT NULL,
  type_compte character varying,
  classe integer,
  lettrable boolean DEFAULT false,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT plan_comptable_pkey PRIMARY KEY (id),
  CONSTRAINT plan_comptable_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.prelevements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  type_prelevement character varying NOT NULL CHECK (type_prelevement::text = ANY (ARRAY['sepa_core'::character varying, 'sepa_b2b'::character varying]::text[])),
  reference_mandat character varying NOT NULL,
  debiteur_nom character varying NOT NULL,
  debiteur_iban character varying,
  debiteur_bic character varying,
  montant numeric NOT NULL,
  date_echeance date NOT NULL,
  motif character varying,
  statut character varying DEFAULT 'a_emettre'::character varying CHECK (statut::text = ANY (ARRAY['a_emettre'::character varying, 'emis'::character varying, 'accepte'::character varying, 'rejete'::character varying, 'annule'::character varying]::text[])),
  banque_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT prelevements_pkey PRIMARY KEY (id),
  CONSTRAINT prelevements_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT prelevements_banque_id_fkey FOREIGN KEY (banque_id) REFERENCES public.banques(id)
);
CREATE TABLE public.produits_services (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  description text,
  type_produit character varying NOT NULL DEFAULT 'produit'::character varying CHECK (type_produit::text = ANY (ARRAY['produit'::character varying, 'service'::character varying, 'consommable'::character varying]::text[])),
  categorie_id uuid,
  unite_mesure_id uuid,
  prix_achat_ht numeric,
  prix_unitaire_ht numeric,
  marge_cible numeric,
  tva_taux_id uuid,
  compte_comptable_id uuid,
  reference_fournisseur character varying,
  code_barre character varying,
  poids_kg numeric,
  volume_l numeric,
  dimensions character varying,
  conditionnement character varying,
  dlc_dluo boolean DEFAULT false,
  stockable boolean DEFAULT true,
  stock_min numeric,
  stock_actuel numeric DEFAULT 0,
  degre_alcool numeric,
  devise_id uuid,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT produits_services_pkey PRIMARY KEY (id),
  CONSTRAINT produits_services_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT produits_services_categorie_id_fkey FOREIGN KEY (categorie_id) REFERENCES public.categories_produits(id),
  CONSTRAINT produits_services_unite_mesure_id_fkey FOREIGN KEY (unite_mesure_id) REFERENCES public.unites_mesure(id),
  CONSTRAINT produits_services_tva_taux_id_fkey FOREIGN KEY (tva_taux_id) REFERENCES public.tva_taux(id),
  CONSTRAINT produits_services_compte_comptable_id_fkey FOREIGN KEY (compte_comptable_id) REFERENCES public.plan_comptable(id),
  CONSTRAINT produits_services_devise_id_fkey FOREIGN KEY (devise_id) REFERENCES public.devises(id)
);
CREATE TABLE public.projets (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_projet character varying NOT NULL,
  libelle character varying NOT NULL,
  description text,
  chef_projet_id uuid,
  date_debut date,
  date_fin_prevue date,
  date_fin_reelle date,
  budget numeric,
  statut character varying DEFAULT 'planifie'::character varying CHECK (statut::text = ANY (ARRAY['planifie'::character varying, 'en_cours'::character varying, 'en_pause'::character varying, 'termine'::character varying, 'annule'::character varying]::text[])),
  priorite character varying DEFAULT 'normale'::character varying CHECK (priorite::text = ANY (ARRAY['basse'::character varying, 'normale'::character varying, 'haute'::character varying, 'critique'::character varying]::text[])),
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT projets_pkey PRIMARY KEY (id),
  CONSTRAINT projets_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT projets_chef_projet_id_fkey FOREIGN KEY (chef_projet_id) REFERENCES public.users(id)
);
CREATE TABLE public.prospects (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_prospect character varying NOT NULL,
  raison_sociale character varying NOT NULL,
  forme_juridique character varying,
  siret character varying,
  adresse text,
  code_postal character varying,
  ville character varying,
  pays character varying DEFAULT 'France'::character varying,
  telephone character varying,
  email character varying,
  site_web character varying,
  statut character varying DEFAULT 'nouveau'::character varying CHECK (statut::text = ANY (ARRAY['nouveau'::character varying, 'contacte'::character varying, 'qualifie'::character varying, 'proposition'::character varying, 'converti'::character varying, 'perdu'::character varying]::text[])),
  origine character varying,
  ca_estime numeric,
  secteur_activite character varying,
  assigned_to uuid,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT prospects_pkey PRIMARY KEY (id),
  CONSTRAINT prospects_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT prospects_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id)
);
CREATE TABLE public.rapprochements_bancaires (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  banque_id uuid NOT NULL,
  date_rapprochement date NOT NULL,
  solde_releve numeric NOT NULL,
  solde_comptable numeric NOT NULL,
  ecart numeric NOT NULL DEFAULT 0,
  statut character varying DEFAULT 'en_cours'::character varying CHECK (statut::text = ANY (ARRAY['en_cours'::character varying, 'valide'::character varying, 'annule'::character varying]::text[])),
  validated_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT rapprochements_bancaires_pkey PRIMARY KEY (id),
  CONSTRAINT rapprochements_bancaires_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT rapprochements_bancaires_banque_id_fkey FOREIGN KEY (banque_id) REFERENCES public.banques(id),
  CONSTRAINT rapprochements_bancaires_validated_by_fkey FOREIGN KEY (validated_by) REFERENCES public.users(id)
);
CREATE TABLE public.receptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code_reception character varying NOT NULL,
  commande_achat_id uuid,
  fournisseur_id uuid NOT NULL,
  date_reception date NOT NULL,
  numero_bl character varying,
  statut character varying DEFAULT 'recu'::character varying CHECK (statut::text = ANY (ARRAY['recu'::character varying, 'partiel'::character varying, 'conforme'::character varying, 'litige'::character varying]::text[])),
  notes text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT receptions_pkey PRIMARY KEY (id),
  CONSTRAINT receptions_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT receptions_commande_achat_id_fkey FOREIGN KEY (commande_achat_id) REFERENCES public.commandes_achat(id),
  CONSTRAINT receptions_fournisseur_id_fkey FOREIGN KEY (fournisseur_id) REFERENCES public.fournisseurs(id),
  CONSTRAINT receptions_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.reglements_clients (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  facture_vente_id uuid NOT NULL,
  date_reglement date NOT NULL,
  montant numeric NOT NULL,
  mode_reglement_id uuid,
  banque_id uuid,
  reference character varying,
  notes text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT reglements_clients_pkey PRIMARY KEY (id),
  CONSTRAINT reglements_clients_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT reglements_clients_facture_vente_id_fkey FOREIGN KEY (facture_vente_id) REFERENCES public.factures_vente(id),
  CONSTRAINT reglements_clients_mode_reglement_id_fkey FOREIGN KEY (mode_reglement_id) REFERENCES public.modes_reglement(id),
  CONSTRAINT reglements_clients_banque_id_fkey FOREIGN KEY (banque_id) REFERENCES public.banques(id),
  CONSTRAINT reglements_clients_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.reglements_fournisseurs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  facture_achat_id uuid NOT NULL,
  date_reglement date NOT NULL,
  montant numeric NOT NULL,
  mode_reglement_id uuid,
  banque_id uuid,
  reference character varying,
  notes text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT reglements_fournisseurs_pkey PRIMARY KEY (id),
  CONSTRAINT reglements_fournisseurs_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT reglements_fournisseurs_facture_achat_id_fkey FOREIGN KEY (facture_achat_id) REFERENCES public.factures_achat(id),
  CONSTRAINT reglements_fournisseurs_mode_reglement_id_fkey FOREIGN KEY (mode_reglement_id) REFERENCES public.modes_reglement(id),
  CONSTRAINT reglements_fournisseurs_banque_id_fkey FOREIGN KEY (banque_id) REFERENCES public.banques(id),
  CONSTRAINT reglements_fournisseurs_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.relances_clients (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  facture_vente_id uuid NOT NULL,
  client_id uuid NOT NULL,
  date_relance date NOT NULL,
  numero_relance integer NOT NULL DEFAULT 1,
  type_relance character varying DEFAULT 'email'::character varying CHECK (type_relance::text = ANY (ARRAY['email'::character varying, 'courrier'::character varying, 'telephone'::character varying, 'mise_en_demeure'::character varying]::text[])),
  montant_du numeric,
  objet text,
  statut character varying DEFAULT 'envoyee'::character varying,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT relances_clients_pkey PRIMARY KEY (id),
  CONSTRAINT relances_clients_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT relances_clients_facture_vente_id_fkey FOREIGN KEY (facture_vente_id) REFERENCES public.factures_vente(id),
  CONSTRAINT relances_clients_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id),
  CONSTRAINT relances_clients_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.reservations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['salle'::character varying, 'vehicule'::character varying, 'hotel'::character varying, 'materiel'::character varying, 'autre'::character varying]::text[])),
  ressource character varying NOT NULL,
  local_id uuid,
  date_debut timestamp with time zone NOT NULL,
  date_fin timestamp with time zone NOT NULL,
  objet character varying,
  reserve_par uuid,
  statut character varying DEFAULT 'confirmee'::character varying CHECK (statut::text = ANY (ARRAY['provisoire'::character varying, 'confirmee'::character varying, 'annulee'::character varying]::text[])),
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT reservations_pkey PRIMARY KEY (id),
  CONSTRAINT reservations_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT reservations_local_id_fkey FOREIGN KEY (local_id) REFERENCES public.locaux(id),
  CONSTRAINT reservations_reserve_par_fkey FOREIGN KEY (reserve_par) REFERENCES public.users(id)
);
CREATE TABLE public.ressources_projet (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  projet_id uuid NOT NULL,
  employe_id uuid,
  user_id uuid,
  role_projet character varying,
  date_debut date,
  date_fin date,
  charge_prevue_h numeric,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT ressources_projet_pkey PRIMARY KEY (id),
  CONSTRAINT ressources_projet_projet_id_fkey FOREIGN KEY (projet_id) REFERENCES public.projets(id),
  CONSTRAINT ressources_projet_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id),
  CONSTRAINT ressources_projet_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.role_permissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  role_id uuid NOT NULL,
  permission_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT role_permissions_pkey PRIMARY KEY (id),
  CONSTRAINT role_permissions_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id),
  CONSTRAINT role_permissions_permission_id_fkey FOREIGN KEY (permission_id) REFERENCES public.permissions(id)
);
CREATE TABLE public.roles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  libelle character varying NOT NULL,
  description text,
  niveau integer NOT NULL DEFAULT 1,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT roles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.taches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  titre character varying NOT NULL,
  description text,
  categorie character varying,
  priorite character varying DEFAULT 'normale'::character varying CHECK (priorite::text = ANY (ARRAY['basse'::character varying, 'normale'::character varying, 'haute'::character varying, 'urgente'::character varying]::text[])),
  date_echeance date,
  assigned_to uuid,
  statut character varying DEFAULT 'a_faire'::character varying CHECK (statut::text = ANY (ARRAY['a_faire'::character varying, 'en_cours'::character varying, 'en_attente'::character varying, 'terminee'::character varying, 'annulee'::character varying]::text[])),
  compte_rendu_id uuid,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT taches_pkey PRIMARY KEY (id),
  CONSTRAINT taches_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT taches_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id),
  CONSTRAINT taches_compte_rendu_id_fkey FOREIGN KEY (compte_rendu_id) REFERENCES public.comptes_rendus(id),
  CONSTRAINT taches_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.taches_projet (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  projet_id uuid NOT NULL,
  titre character varying NOT NULL,
  description text,
  ordre integer,
  date_debut date,
  date_fin_prevue date,
  date_fin_reelle date,
  duree_estimee_h numeric,
  assigned_to uuid,
  statut character varying DEFAULT 'a_faire'::character varying CHECK (statut::text = ANY (ARRAY['a_faire'::character varying, 'en_cours'::character varying, 'en_attente'::character varying, 'terminee'::character varying, 'annulee'::character varying]::text[])),
  priorite character varying DEFAULT 'normale'::character varying,
  tache_parente_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT taches_projet_pkey PRIMARY KEY (id),
  CONSTRAINT taches_projet_projet_id_fkey FOREIGN KEY (projet_id) REFERENCES public.projets(id),
  CONSTRAINT taches_projet_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id),
  CONSTRAINT taches_projet_tache_parente_id_fkey FOREIGN KEY (tache_parente_id) REFERENCES public.taches_projet(id)
);
CREATE TABLE public.taux_change (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  devise_source_id uuid NOT NULL,
  devise_cible_id uuid NOT NULL,
  taux numeric NOT NULL,
  date_taux date NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT taux_change_pkey PRIMARY KEY (id),
  CONSTRAINT taux_change_devise_source_id_fkey FOREIGN KEY (devise_source_id) REFERENCES public.devises(id),
  CONSTRAINT taux_change_devise_cible_id_fkey FOREIGN KEY (devise_cible_id) REFERENCES public.devises(id)
);
CREATE TABLE public.tenants (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  raison_sociale character varying NOT NULL,
  forme_juridique character varying,
  capital numeric,
  siret character varying UNIQUE,
  siren character varying,
  ape character varying,
  tva_intra character varying,
  rcs character varying,
  adresse text,
  complement_adresse text,
  code_postal character varying,
  ville character varying,
  pays character varying NOT NULL DEFAULT 'France'::character varying,
  telephone character varying,
  telephone_secondaire character varying,
  email character varying,
  site_web character varying,
  effectif integer,
  secteur_activite character varying,
  convention_collective character varying,
  regime_fiscal character varying DEFAULT 'IS'::character varying,
  regime_tva character varying DEFAULT 'reel_normal'::character varying,
  date_creation date,
  date_installation timestamp with time zone NOT NULL DEFAULT now(),
  type_prestation character varying DEFAULT 'complet'::character varying,
  domaine_email character varying,
  logo_url text,
  statut character varying NOT NULL DEFAULT 'actif'::character varying CHECK (statut::text = ANY (ARRAY['actif'::character varying, 'inactif'::character varying, 'suspendu'::character varying, 'resilie'::character varying]::text[])),
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT tenants_pkey PRIMARY KEY (id)
);
CREATE TABLE public.tva_taux (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  code character varying NOT NULL,
  libelle character varying NOT NULL,
  taux numeric NOT NULL,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT tva_taux_pkey PRIMARY KEY (id),
  CONSTRAINT tva_taux_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.types_absence (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  libelle character varying NOT NULL,
  conges_payes boolean DEFAULT false,
  decompte_jours boolean DEFAULT true,
  couleur character varying,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT types_absence_pkey PRIMARY KEY (id)
);
CREATE TABLE public.unites_mesure (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  libelle character varying NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT unites_mesure_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_roles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  role_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT user_roles_pkey PRIMARY KEY (id),
  CONSTRAINT user_roles_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT user_roles_role_id_fkey FOREIGN KEY (role_id) REFERENCES public.roles(id)
);
CREATE TABLE public.user_tenants (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  tenant_id uuid NOT NULL,
  role_tenant character varying,
  est_default boolean DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT user_tenants_pkey PRIMARY KEY (id),
  CONSTRAINT user_tenants_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT user_tenants_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  auth_user_id uuid UNIQUE,
  email character varying NOT NULL UNIQUE,
  civilite character varying,
  prenom character varying NOT NULL,
  nom character varying NOT NULL,
  nom_usage character varying,
  date_naissance date,
  lieu_naissance character varying,
  nationalite character varying DEFAULT 'Fran√ßaise'::character varying,
  numero_ss character varying,
  adresse_perso text,
  code_postal_perso character varying,
  ville_perso character varying,
  pays_perso character varying DEFAULT 'France'::character varying,
  telephone character varying,
  telephone_perso character varying,
  fonction character varying,
  service character varying,
  date_entree date,
  date_sortie date,
  avatar_url text,
  derniere_connexion timestamp with time zone,
  actif boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  metier_cible character varying CHECK (metier_cible IS NULL OR (metier_cible::text = ANY (ARRAY['comptable_assistant'::character varying, 'assistant_commercial'::character varying, 'secretaire_comptable'::character varying, 'secretaire_assistant'::character varying, 'assistant_direction'::character varying, 'gestionnaire_comptable_fiscal'::character varying, 'assistant_rh'::character varying, 'gestionnaire_paie'::character varying]::text[]))),
  CONSTRAINT users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.variables_paie (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  employe_id uuid NOT NULL,
  periode character varying NOT NULL,
  type_variable character varying NOT NULL,
  libelle character varying NOT NULL,
  quantite numeric,
  montant numeric,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT variables_paie_pkey PRIMARY KEY (id),
  CONSTRAINT variables_paie_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id),
  CONSTRAINT variables_paie_employe_id_fkey FOREIGN KEY (employe_id) REFERENCES public.employes(id)
);